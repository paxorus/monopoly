<!DOCTYPE html>
<html><head><title>Monopoly Game</title>
<link href="/stylesheets/shared.css" rel="stylesheet"></link>
<style>
#invalid-name-message {font-size: 12px; height: 15px}
.highlight-invalid-message {color: red}
</style>
</head>
<body>

<!-- TODO: List games -->

<form id="new-game-form" style="display: inline-block">
	<center>
	Name: <input id="game-name-field" type="text" />
	<div id="invalid-name-message"></div>
	<div id="create-game" class="button button-disabled" style="display: inline-block;">Create</div>
	</center>
</form>

<script src="/javascripts/third-party/jquery.js"></script>
<script>
// Don't reload page on input Enter or button click.
$("#new-game-form").submit(event => event.preventDefault());

$("#game-name-field").on("input", event => {
	// Validate as user types.
	const {isValid, reason} = isValidString(event.target.value);
	$("#create-game").toggleClass("button-disabled", ! isValid);
	$("#invalid-name-message").text(reason);
});

$("#game-name-field").on("blur", event => {
	// Redden invalid reason if user leaves field.
	const reason = $("#invalid-name-message").text();
	if (reason !== "") {
		$("#invalid-name-message").toggleClass("highlight-invalid-message", true);
	}
});


$("#create-game").click(event => {
	// AJAX details to server.
	const gameName = $("#game-name-field").val();
	location.href = `/game/create/${gameName}`;
});

function isValidString(input) {
	if (input.length < 5 || input.length > 50) {
		return {isValid: false, reason: "Name must be 5-50 characters long."};
	}

	for (let i = 0; i < input.length; i ++) {
		const charCode = input.charCodeAt(i);
		if (charCode < 32 || charCode > 126) {
			return {isValid: false, reason: "Invalid character, only alphanumeric and common symbols are allowed."};
		}
	}

	return {isValid: true, reason: ""}
}
</script>
</body></html>